/*
 * Adipoli jQuery Image Hover Plugin
 * http://jobyj.in/adipoli
 *
 * Copyright 2012, Joby Joseph
 * Free to use under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
!function(i){i.fn.adipoli=function(e){function t(e,t){for(var o=0;o<t.slices;o++){var a=Math.round(e.width()/t.slices);e.children(".adipoli-after").append(o==t.slices-1?i('<div class="adipoli-slice"></div>').css({left:a*o+"px",width:e.width()-a*o+"px",height:"0px",opacity:"0",background:'url("'+e.children("img").attr("src")+'") no-repeat -'+(a+o*a-a)+"px 0%"}):i('<div class="adipoli-slice"></div>').css({left:a*o+"px",width:a+"px",height:"0px",opacity:"0",background:'url("'+e.children("img").attr("src")+'") no-repeat -'+(a+o*a-a)+"px 0%"}))}}function o(e,t){for(var o=Math.round(e.width()/t.boxCols),a=Math.round(e.height()/t.boxRows),r=0;r<t.boxRows;r++)for(var s=0;s<t.boxCols;s++)e.children(".adipoli-after").append(s==t.boxCols-1?i('<div class="adipoli-box"></div>').css({opacity:0,left:o*s+"px",top:a*r+"px",width:e.width()-o*s+"px",height:a+"px",background:'url("'+e.children("img").attr("src")+'") no-repeat -'+(o+s*o-o)+"px -"+(a+r*a-a)+"px"}):i('<div class="adipoli-box"></div>').css({opacity:0,left:o*s+"px",top:a*r+"px",width:o+"px",height:a+"px",background:'url("'+e.children("img").attr("src")+'") no-repeat -'+(o+s*o-o)+"px -"+(a+r*a-a)+"px"}))}function a(i){for(var e,t,o=i.length;o;e=parseInt(Math.random()*o),t=i[--o],i[o]=i[e],i[e]=t);return i}function r(i){var e=document.createElement("canvas"),t=e.getContext("2d"),o=new Image;o.crossOrigin="anonymous",o.src=i.src,o.onload=function(){e.width=o.width,e.height=o.height,t.drawImage(o,0,0);for(var a=t.getImageData(0,0,e.width,e.height),r=0;r<a.height;r++)for(var s=0;s<a.width;s++){var h=4*r*a.width+4*s,c=(a.data[h]+a.data[h+1]+a.data[h+2])/3;a.data[h]=c,a.data[h+1]=c,a.data[h+2]=c}t.putImageData(a,0,0,0,0,a.width,a.height),i.src=e.toDataURL()}}var s=i.extend({startEffect:"transparent",hoverEffect:"normal",imageOpacity:.5,animSpeed:300,fillColor:"#000",textColor:"#fff",overlayText:"",slices:10,boxCols:5,boxRows:3,popOutMargin:10,popOutShadow:10},e);return i(this).one("load",function(){if(i(this).wrap(function(){return'<div class="adipoli-wrapper '+i(this).attr("class")+'" style="width:'+i(this).width()+"px; height:"+i(this).height()+'px;"/>'}),i(this).parent().append('<div class="adipoli-before '+i(this).attr("class")+'" style="display:none;width:'+i(this).width()+"px; height:"+i(this).height()+'px;"><img src="'+i(this).attr("src")+'"/></div>'),i(this).parent().append('<div class="adipoli-after '+i(this).attr("class")+'" style="display:none;width:'+i(this).width()+"px; height:"+i(this).height()+'px;"></div>'),"transparent"==s.startEffect)i(this).hide(),i(this).siblings(".adipoli-before").css({"-ms-filter":'"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*s.imageOpacity+')"',filter:"alpha(opacity="+100*s.imageOpacity+")","-moz-opacity":s.imageOpacity,"-khtml-opacity":s.imageOpacity,opacity:s.imageOpacity}).show();else if("grayscale"==s.startEffect){var e=i(this);e.hide(),e.siblings(".adipoli-before").show(),e.siblings(".adipoli-before").children("img").each(function(){r(this)})}else"normal"==s.startEffect?(i(this).hide(),i(this).siblings(".adipoli-before").show()):"overlay"==s.startEffect&&(e=i(this),e.hide(),i(this).siblings(".adipoli-before").html(s.overlayText).css({"-ms-filter":'"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*s.imageOpacity+')"',filter:"alpha(opacity="+100*s.imageOpacity+")","-moz-opacity":s.imageOpacity,"-khtml-opacity":s.imageOpacity,opacity:s.imageOpacity,background:s.fillColor,color:s.textColor}).fadeIn(),e.show());i(this).parent().bind("mouseenter",function(){if("normal"==s.hoverEffect){var e=i(this);e.children(".adipoli-after").html('<img src="'+e.children("img").attr("src")+'"/>').fadeIn(s.animSpeed)}else if("popout"==s.hoverEffect){e=i(this);var r=e.children("img").width(),h=e.children("img").height();e.children(".adipoli-after").html('<img src="'+e.children("img").attr("src")+'"/>');var c=e.children(".adipoli-after").children("img");c.width(r+2*s.popOutMargin),c.height(h+2*s.popOutMargin),e.children(".adipoli-after").width(r+2*s.popOutMargin),e.children(".adipoli-after").height(h+2*s.popOutMargin),e.children(".adipoli-after").css({left:"-"+s.popOutMargin+"px",top:"-"+s.popOutMargin+"px","box-shadow":"0px 0px "+s.popOutShadow+"px #000"}).show()}else if("sliceDown"==s.hoverEffect||"sliceDownLeft"==s.hoverEffect||"sliceUp"==s.hoverEffect||"sliceUpLeft"==s.hoverEffect||"sliceUpRandom"==s.hoverEffect||"sliceDownRandom"==s.hoverEffect){i(this).children(".adipoli-after").show(),t(i(this),s);var n=0,p=0,f=i(".adipoli-slice",i(this));("sliceDownLeft"==s.hoverEffect||"sliceUpLeft"==s.hoverEffect)&&(f=i(".adipoli-slice",i(this))._reverse()),("sliceUpRandom"==s.hoverEffect||"sliceDownRandom"==s.hoverEffect)&&(f=a(i(".adipoli-slice",i(this)))),f.each(function(){var e=i(this);"sliceDown"==s.hoverEffect||"sliceDownLeft"==s.hoverEffect?e.css({top:"0px"}):("sliceUp"==s.hoverEffect||"sliceUpLeft"==s.hoverEffect)&&e.css({bottom:"0px"}),p==s.slices-1?setTimeout(function(){e.animate({height:"100%",opacity:"1.0"},s.animSpeed,"",function(){})},100+n):setTimeout(function(){e.animate({height:"100%",opacity:"1.0"},s.animSpeed)},100+n),n+=50,p++})}else if("sliceUpDown"==s.hoverEffect||"sliceUpDownLeft"==s.hoverEffect){i(this).children(".adipoli-after").show(),t(i(this),s),n=0,p=0;var l=0;f=i(".adipoli-slice",i(this)),"sliceUpDownLeft"==s.hoverEffect&&(f=i(".adipoli-slice",i(this))._reverse()),f.each(function(){var e=i(this);0==p?(e.css("top","0px"),p++):(e.css("bottom","0px"),p=0),l==s.slices-1?setTimeout(function(){e.animate({height:"100%",opacity:"1.0"},s.animSpeed,"",function(){})},100+n):setTimeout(function(){e.animate({height:"100%",opacity:"1.0"},s.animSpeed)},100+n),n+=50,l++})}else if("fold"==s.hoverEffect||"foldLeft"==s.hoverEffect)i(this).children(".adipoli-after").show(),e=i(this),t(e,s),n=0,p=0,f=i(".adipoli-slice",e),"foldLeft"==s.hoverEffect&&(f=i(".adipoli-slice",i(this))._reverse()),f.each(function(){var e=i(this),t=e.width();e.css({top:"0px",height:"100%",width:"0px"}),p==s.slices-1?setTimeout(function(){e.animate({width:t,opacity:"1.0"},s.animSpeed,"",function(){})},100+n):setTimeout(function(){e.animate({width:t,opacity:"1.0"},s.animSpeed)},100+n),n+=50,p++});else if("boxRandom"==s.hoverEffect){i(this).children(".adipoli-after").show(),e=i(this),o(e,s);var d=s.boxCols*s.boxRows;p=0,n=0;var m=a(i(".adipoli-box",e));m.each(function(){var e=i(this);p==d-1?setTimeout(function(){e.animate({opacity:"1"},s.animSpeed,"",function(){})},100+n):setTimeout(function(){e.animate({opacity:"1"},s.animSpeed)},100+n),n+=20,p++})}else if("boxRain"==s.hoverEffect||"boxRainReverse"==s.hoverEffect||"boxRainGrow"==s.hoverEffect||"boxRainGrowReverse"==s.hoverEffect){i(this).children(".adipoli-after").show(),e=i(this),o(e,s),d=s.boxCols*s.boxRows,p=0,n=0;var v=0,g=0,u=new Array;u[v]=new Array,m=i(".adipoli-box",e),("boxRainReverse"==s.hoverEffect||"boxRainGrowReverse"==s.hoverEffect)&&(m=i(".adipoli-box",e)._reverse()),m.each(function(){u[v][g]=i(this),g++,g==s.boxCols&&(v++,g=0,u[v]=new Array)});for(var x=0;x<2*s.boxCols;x++){for(var w=x,b=0;b<s.boxRows;b++)w>=0&&w<s.boxCols&&(!function(e,t,o,a,r){var h=i(u[e][t]),c=h.width(),n=h.height();("boxRainGrow"==s.hoverEffect||"boxRainGrowReverse"==s.hoverEffect)&&h.width(0).height(0),a==r-1?setTimeout(function(){h.animate({opacity:"1",width:c,height:n},s.animSpeed/1.3,"",function(){})},100+o):setTimeout(function(){h.animate({opacity:"1",width:c,height:n},s.animSpeed/1.3)},100+o)}(b,w,n,p,d),p++),w--;n+=100}}}),i(this).parent().bind("mouseleave",function(){i(this).children(".adipoli-after").html("").hide()})}).each(function(){this.complete&&i(this).load()}),i(this)},i.fn._reverse=[].reverse}(jQuery);